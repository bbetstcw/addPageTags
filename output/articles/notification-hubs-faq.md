<properties 
	pageTitle="Azure 通知中心 - 常见问题 (Faq)" 
	description="关于设计/实现有关通知中心的解决方案的常见问题" 
	services="notification-hubs" 
	documentationCenter="mobile" 
	authors="piyushjo" 
	manager="dwrede" 
	editor="" />

<tags 
	ms.service="notification-hubs" 
	ms.date="02/18/2015" 
	wacn.date="08/29/2015" />

# Azure 通知中心 - 常见问题 (Faq)

## 常规问题
### 1.通知中心的定价有哪些？
通知中心按三层提供 - *免费*、*基本*和*标准*层。详细信息，请访问此处 - [通知中心定价]。定价根据订阅级别和推送次数收费，因此，命名空间或通知中心的多少与此无关。免费层适用于没有 SLA 保证的开发目的。基本和标准层适用于具有以下仅针对标准层启用的关键特性的生产使用情况：

- *广播* - 基本层将通知中心标记数限制为 3 K（适用于 > 5 台设备）。如果受众大小大于 3K，则您必须移到标准层。 
- *丰富的遥测功能* - 基本层不允许导出遥测或注册数据。如果需要能够导出遥测数据以便进行离线查看和分析，则您必须移到标准层。 
- *多租户* - 如果要使用通知中心创建移动应用以支持多个租户，则必须考虑将移动到标准层。这使您可以在应用的通知中心命名空间级别设置推送通知服务 (PNS) 凭据，然后可以分隔租户以在此公共命名空间下向他们提供单个中心。这样便于维护，同时保存这些 SAS 密钥以从这些针对各个租户分隔的通知中心发送和接收通知，确保不会出现跨租户重叠。 

### 2.什么是 SLA？
对于基本和标准通知中心层，就在基本或标准通知中心层内部署的通知中心而言，我们保证至少在 99.9% 情况下，正确配置的应用程序将能够发送通知或执行注册管理操作。若要详细了解我们的 SLA，请访问此处的 SLA 页面 - [通知中心 SLA]。请注意，由于通知中心依赖于外部平台提供商将通知传递到设备，因此平台通知服务和设备之间没有用于支撑的 SLA 保证。
 
### 3.哪些客户在使用通知中心？
我们有许多客户在使用通知中心，以下是著名的几位客户：

* Sochi 2014 – 数百个兴趣组、300 多万台设备、2 周内发出的通知超过了 1.5 亿条。[案例研究 - Sochi]
* Skanska - [案例研究 - Skanska]
* Seattle Times - [案例研究 - Seattle Times]
* Mural.ly - [案例研究 -Mural.ly]
* 7Digital - [案例研究 - 7Digital]
* 必应应用 – 数千万台设备，每天发送三百多条通知
 
## 设计和开发
### 1.支持哪些服务端平台？
我们针对 .NET、Java、PHP、Python、Node.js 提供有 SDK 和示例，因此，您可通过设置应用后端以使用这些平台中的任一个与通知中心通信。通知中心 API 均基于 REST 接口，以便您可以选择直接与其对话。详细信息请访问此处 - [NH - REST API]
 
### 2.支持哪些设备平台？
我们支持将通知发送到 Apple iOS、Android、Windows 通用和 Windows Phone Kindle、Android 中国（通过百度）、Xamarin（iOS 和 Android）、Chrome 应用平台。有关这些平台的分步入门教程，请访问此处 - [NH - 入门教程]
 
### 3.是否支持 SMS/电子邮件/Web 通知？
通知中心主要针对使用上述平台将通知发送到移动应用而设计。我们不提供发送电子邮件或 SMS 的功能，但提供这些功能的第三方平台可以与通知中心进行集成，以通过使用 Azure 移动服务发送原生推送通知。例如，本教程将探讨如何使用 Azure 移动服务发送 SMS 通知 - [通过移动服务发送 SMS]
我们也不提供现成的浏览器内推送通知。客户可能选择使用 SignalR 实现这一功能。我们还提供了将推送通知发送到将在 Google Chrome 浏览器内运行的 Chrome 应用的教程 。请参阅此 - [Chrome 应用教程]
 
### 4.Azure 移动服务与 Azure 通知中心之间的关系如何以及各自的适用场合？ 
如果您有现成的移动应用后端并且只想添加发送推送通知的功能，则必须使用 Azure 通知中心。如果您想要从头开始安装移动应用后端，那么您应当考虑使用 Azure 移动服务。Azure 移动服务会自动预配通知中心，以便您能够轻松地从移动应用后端发送推送通知。Azure 移动服务的定价包括通知中心的基本费用，您只需在超出所含推送时支付费用。详细信息请访问此处 - [移动服务定价]
 
### 5.通知中心可以支持多少台设备？
在基本和标准层中 - 我们未对可以接收通知的活动设备数量设定任何限制。有关详细信息，请参阅：[通知中心定价]
 
### 6.我可以发送多少推送通知？ 
客户每天可以使用 Azure 通知中心发送数百万条推送通知。您不必执行任何额外操作来扩展通知中心。我们会根据系统中通过的通知数量自动向上扩展。请注意，该定价会受影响于服务的通知数量。
 
### 7.通知到达我的设备需要多长时间？
在正常情况下，Azure 通知中心能够在 1 分钟内处理至少 100 万次发送，其中传入负载本质相当一致，本质上不会出现猛增现象。此速率可能因标记数、传入发送的性质而有所不同。在此持续期间，我们能够计算每个平台的目标，并根据注册的标记/标记表达式将消息路由到各个推送通知服务。然后，由推送通知服务 (PNS) 负责将通知发送到设备。PNS 对于传递通知不保证任何 SLA，但是，一般情况下，绝大多数消息会在几分钟 （< 10 分钟）内从我们的平台传递到设备。可能存在少量可能需要更多时间的异常消息。Azure 通知中心还会有一个策略来删除任何不能在 30 分钟内传送到 PNS 的通知。这一延迟的出现原因有多种，最常见的是因为 PNS 限制了您的应用程序。
 
### 8.是否有任何延迟保证？
由于由外部平台特定的推送通知服务交付的推送通知的性质，因此没有延迟保证。通常情况下，大部分通知会在几分钟内传递到。
 
### 9.我们在设计包含命名空间和通知中心的解决方案时需要考虑哪些因素？ 
*移动应用/环境：*
每个环境中的每个移动应用只应有一个通知中心。在多租户方案中，每个租户都应具有一个单独的中心。
您不能在测试与生产环境之间共享同一通知中心，因为这可能导致发送通知时出现问题，例如，Apple 提供沙盒和每个都具有单独凭据的生产推送终结点。如果中心最初的配置使用的是 Apple 沙盒证书，而后又使用 Apple 生产证书进行了重新配置，则旧的设备令牌将和新证书一起失效，导致推送失败。将生产和测试环境分开，针对不同的环境使用不同的中心是最佳做法。

*PNS 凭据：*
在某个平台的开发人员门户（如Apple 或 Google 等 ）注册了一个移动应用后，您会获得应用标识符和安全令牌，应用后端需要向平台的推送通知服务提供这些信息以便能够将推送通知发送到设备。这些安全令牌可以是证书（例如用于 Apple iOS 或 Windows Phone）或安全密钥（Google Android 和 Windows）等) 等，并需要在通知中心内进行配置。这通常在通知中心级别完成，在多租户方案中，也可在命名空间级别完成。

*命名空间：*
命名空间还可用于部署分组。在多租户方案中，其还可以用于表示同一应用的所有租户的所有通知中心。

*地理分布：*
地理分布并不总是推送通知情况下的关键所在。请注意，各种最终将推送通知传递至设备的推送通知服务（如 APNS、GCM 等）并不是均匀分布的。但是，如果您有一个用于世界范围的应用程序，那么您可以在不同的命名空间内创建若干中心以利用全世界不同 Azure 区域中可用的通知中心服务。请注意，这将增加管理成本，尤其是注册方面，因此不建议如此，仅在真正需要时采用此方法。
 
### 10.我们该从应用后端或从设备直接进行注册吗？
在创建注册之前，当您必须进行客户端身份验证时，或者，当您拥有必须根据某些应用逻辑由应用后端创建或修改的标记时，从应用后端进行注册很有用。更多指导请访问此处 - [后端注册指导]与[后端注册指南 - 2]
 
### 11.安全模型是什么？
Azure 通知中心使用基于安全模型的共享访问签名 (SAS) 。您可以在根命名空间级别或细粒度通知中心级别使用 SAS 令牌。这些 SAS 令牌可以使用不同的授权规则进行设置，如发送消息权限、侦听通知权限等。详细信息请访问 [NH 安全模型]
 
### 12.通知中心如何处理通知中的敏感负载？ 
所有通知都由平台推送通知服务 (PNS) 传递到设备。当发件人将通知发送到 Azure 通知中心后，我们会对通知进行处理并传递到各自的 PNS。从发送方到 Azure 通知中心、而后再到 PNS 的所有连接都使用 HTTPS。Azure 通知中心不会以任何方式记录消息的负载。
但是，对于发送敏感负载，我们建议使用安全推送模式，在该模式下，发件人将带有消息标识符的 ping 通知发送到设备，其中不包含敏感负载，当设备上的应用接收到此负载后，其将调用安全应用后端 API 直接提取消息详细信息。实施该模式的教程请访问 [NH - 安全推送教程]
 
## 操作
### 1.什么是灾难恢复 (DR) 情景？
我们在我们这端提供元数据灾难恢复（通知中心名称、 连接字符串等） 。在执行灾难恢复时，注册数据会包含在丢失信息中，因此您必须拿出一个解决方案来将此信息重新填入您的新中心。

- *步骤 1* - 在另一个 DC 中创建辅助通知中心。您可以在 DR 事件中动态创建此辅助中心，或者在一开始就创建一个。因为 NH 预配过程只需几秒，所以关系不大。建议一开始就创建好辅助中心，如此，尽管 DR 事件会影响到我们的管理能力，但不会波及到您。 

- *步骤 2* - 使用主通知中心的注册信息冻结辅助通知中心。不建议尝试在两个中心上维护注册信息并尝试在注册信息进入时动态保持这些信息同步，由于注册信息是由 PNS 确定是否过期这一固有性质，因此效果不佳。在我们收到 PNS 关于过期的或无效注册的反馈后，通知中心会将这些注册信息清除。

建议使用具有以下功能之一的应用后端：

- 可在其一端维护一套注册信息，以便其可以在 DR 情况下将这些信息批量插入辅助通知中心，或者

- 从主中心获取注册信息的常规转储作为备份，然后批量插入辅助 NH。

（注册导出/导入功能在标准层中有提供，请访问：[注册导出/导入]）
 
如果您没有后端，那么当应用在设备上启动后，其会在辅助通知中心执行新注册，最终，辅助通知中心会将所有活动设备进行注册，但缺点是会出现这样的时间段，即其中应用没有打开的设备将不会收到通知。
 
### 2.是否有任何审核日志功能？
有关所有通知中心管理操作，请转至 Azure 管理门户中公开的操作日志。
 
## 监视与故障排除
### 1.故障排除功能有哪些？
Azure 通知中心提供了多种可执行常见故障排除的功能，特别是在有关已删除通知的最常见情况中。有关故障排除的详细信息，请参阅白皮书 [NH - 故障排除]
 
### 2.遥测功能有哪些？
Azure 通知中心支持在 Azure 管理门户中查看遥测数据。有关可用度量值的详细信息，请访问 [NH - 度量值]。
请注意，通知成功仅意味着通知已传递到外部推送通知服务（例如，适用于 Apple 的 APNS、适用于 Google 的 GCM 等），而后，由 PNS 将通知传递至设备，PNS 不会向我们公开这些度量值。  
它还提供了以编程方式导出遥测数据的功能（在标准层）。请参阅此示例了解详细信息 - [NH - 度量值示例]

[通知中心定价]: http://www.windowsazure.cn/home/features/notification-hubs/#price
[通知中心 SLA]: http://www.windowsazure.cn/support/legal/sla
[NH - REST API]: https://msdn.microsoft.com/zh-cn/library/azure/dn530746.aspx
[NH - 入门教程]: /documentation/articles/notification-hubs-ios-get-started
[通过移动服务发送 SMS]: /documentation/articles/partner-twilio-mobile-services-how-to-use-voice-sms
[Chrome 应用教程]: /documentation/articles/notification-hubs-chrome-get-started
[移动服务定价]: http://www.windowsazure.cn/home/features/mobile-services/#price
[后端注册指导]: https://msdn.microsoft.com/zh-cn/library/azure/dn743807.aspx
[后端注册指南 - 2]: https://msdn.microsoft.com/zh-cn/library/azure/dn530747.aspx
[NH 安全模型]: https://msdn.microsoft.com/zh-cn/library/azure/dn495373.aspx
[NH - 安全推送教程]: /documentation/articles/notification-hubs-aspnet-backend-ios-secure-push
[NH - 故障排除]: /documentation/articles/notification-hubs-diagnosing
[NH - 度量值]: https://msdn.microsoft.com/zh-cn/library/dn458822.aspx
[NH - 度量值示例]: https://github.com/Azure/azure-notificationhubs-samples/tree/master/FetchNHTelemetryInExcel
[注册导出/导入]: https://msdn.microsoft.com/zh-cn/library/dn790624.aspx
 

<!---HONumber=67-->