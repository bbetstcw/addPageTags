<properties title="Operating System Functionality Available to Applications on Azure Web Sites" pageTitle="Operating System Functionality Available to Applications on Azure Web Sites" description="Learn about the OS functionality available to web applications on Azure Web Sites" metaKeywords="Azure,Web Sites,web applications,operating system functionality" services="web-sites" solutions="web" documentationCenter="" authors="timamm" manager="paulettm" editor="mollybos" videoId="" scriptId="" />
<tags ms.service="web-sites"
    ms.date="11/11/2014"
    wacn.date="04/11/2015"
    />

# 可用于 Azure 网站上的应用程序的操作系统功能

本文介绍可用于在 Azure 网站上运行的所有应用程序的常见基准操作系统功能。这些功能包括文件、网络和注册表访问以及诊断日志和事件。

## 目录

-   [网站模式][网站模式]
-   [开发框架][开发框架]
-   [文件访问][文件访问]

    -   [本地驱动器][本地驱动器]
    -   [网络驱动器（aka UNC 共享）][网络驱动器（aka UNC 共享）]
    -   [跨多个实例的文件][跨多个实例的文件]
    -   [向 Web 应用程序授予的文件访问的类型][向 Web 应用程序授予的文件访问的类型]
-   [网络访问][网络访问]
-   [代码执行、处理和内存][代码执行、处理和内存]
-   [诊断日志和事件][诊断日志和事件]
-   [注册表访问][注册表访问]

<span id="websitemodes"></span></a>

## 网站模式

Azure 网站在多租户托管环境中运行客户网站。部署在“免费”和“共享”网站缩放模式下的网站在共享虚拟机上的辅助进程中运行，而在标准网站缩放模式下部署的网站在专用于与单个客户相关联的网站的虚拟机上运行。

</p>
因为 Azure 网站支持不同模式之间的无缝缩放体验，所以，为网站实施的安全配置保持不变。这确保某一网站在网站模式之间切换时，Web 应用程序不会突然发生行为上的变化，并且不会以意外的方式失败。

<span id="developmentframeworks"></span></a>

## 开发框架

</p>
网站模式控制可用于网站的计算资源量（CPU、磁盘存储、内存和网络传出）。但是，可用于应用程序的框架功能幅度保持不变，而与网站模式无关。

Azure 网站支持多种开发框架，包括 ASP.NET、经典 ASP、node.js、PHP 和 python – 它们全都作为 IIS 中的扩展运行。为了简化和标准化安全配置，Azure 网站通常使用其默认设置运行不同的开发框架。用于配置 Azure 网站的一个方法可能是为每个单独的开发框架自定义 API 外围应用和功能。Azure 网站而是通过实现操作系统功能的公共基准，采用更通用的方法，与网站的应用程序开发框架无关。

以下各节概述了可用于 Azure 上的网站的一般类型的操作系统功能。

<span id="FileAccess"></span></a>

## 文件访问

</p>
Azure 网站中存在各种不同的驱动器，包括本地驱动器和网络驱动器。

<span id="LocalDrives"></span></a>

### 本地驱动器

</p>
就其核心而言，Azure 网站是在 Azure PaaS（平台即服务）基础结构的基础上运行的服务。因此，“附加到”虚拟机的本地驱动器是可用于在 Azure 中运行的任何辅助角色的相同驱动器类型。这包括操作系统驱动器（D:&#92; 驱动器）、包含 Azure 网站专用（客户不可访问）的 Azure 程序包 cspkg 文件的应用程序驱动器，以及其大小因虚拟机大小而异的“user”驱动器（C:&#92; 驱动器）。

<span id="NetworkDrives"></span></a>

### 网络驱动器（aka UNC 共享）

</p>
Azure 网站中有一个独具特色的方面能够简化 Web 应用程序的部署和维护，这就是所有用户内容都存储在一组 UNC 共享中。此模型非常好地映射到具有多个负载平衡服务器的本地 Web 托管环境所用内容存储的公共模式。

在 Azure 网站内，每个数据中心都创建了许多 UNC 共享。在每个数据中心针对所有客户的某个百分比的用户内容将分配给各 UNC 共享。此外，针对单个客户订阅的所有文件内容将始终置于相同的 UNC 共享中。

请注意，由于云服务的工作方式，负责托管 UNC 共享的特定虚拟机将随着时间而更改。应确保将由不同虚拟机装入 UNC 共享，因为在正常云操作过程中它们将会启动和关闭。因此，Web 应用程序应该永远不会作出这样的硬编码的假定，即 UNC 文件路径中的计算机信息将在一段时间后保持不变。它们应使用 Azure 网站提供的方便的 *faux* 绝对路径 **D:&#92;home&#92;site**。此 faux 绝对路径为引用自己的网站提供可移植的站点到用户未知方法。通过使用 **D:&#92;home&#92;site**，可以在网站之间传输共享文件，而不必为每次传输都配置新的绝对路径。

<span id="TypesOfFileAccess"></span></a>

### 向 Web 应用程序授予的文件访问的类型

</p>
每个客户的订阅都在一个数据中心内的特定 UNC 共享上具有保留的目录结构。一个客户可以在特定数据中心内创建多个网站，因此，属于单个客户订阅的所有目录都在同一个 UNC 共享上创建。该共享可以包含目录（例如针对内容、错误和诊断日志的目录）以及源代码管理创建的网站的更早版本。按照预期，客户的网站目录可用于在运行时由网站的应用程序代码进行读写访问。

在附加到运行网站的虚拟机的本地驱动器上，Azure 网站在 C:&#92; 驱动器上为特定于网站的临时本地存储预留一块空间。尽管网站对自己的临时本地存储具有完全读/写访问权限，但该存储实际上并不旨在直接供应用程序代码使用。而是用于为 IIS 和 Web 应用程序框架提供临时文件存储。Azure 网站还限制可用于各网站的临时本地存储量，以免单独网站占用过多的本地文件存储量。

说明 Azure 网站如何使用临时本地存储的两个示例是针对临时 ASP.NET 文件的目录和针对 IIS 压缩文件的目录。ASP.NET 编译系统使用“临时 ASP.NET 文件”目录作为临时编译缓存位置。IIS 使用“IIS 临时压缩文件”目录存储压缩的响应输出。在 Azure 网站中，这两种类型的文件使用（以及其他使用）都重新映射到各网站临时本地存储。此重新映射确保该功能按预期延续。

Azure 网站中的每个网站都以称作“应用程序池标识”的随机唯一低权限辅助进程标识运行，下面的网址中进一步说明了此行为：[][]<http://www.iis.net/learn/manage/configuring-security/application-pool-identities></a>。应用程序代码将此标识由于对操作系统驱动器（D:&#92; 驱动器）的基本的只读访问。这意味着应用程序代码可以列出公共目录结构并且读取操作系统驱动器上的公共文件。尽管这可能看上去就好像是一种较为广泛的访问级别，但当你在 Azure 托管服务中设置某一辅助角色并且读取驱动器内容时，相同的目录和文件是可访问的。

<a name="multipleinstances"></a>

### 跨多个实例的文件访问

主目录包含网站的内容，并且 Web 应用程序可以写入该目录。如果网站在多个实例上运行，则主目录在所有实例间共享，以便所有实例都看到同一个目录。所以，举例来说，如果网站将上载文件保存到主目录，则所有实例都可以立即使用那些文件。

<span id="NetworkAccess"></span></a>

## 网络访问

应用程序代码可以使用基于 TCP/IP 和 UDP 的协议建立与公开外部服务的 Internet 可访问终结点的出站网络连接。应用程序可以使用这些相同协议连接到 Azure 内的服务，例如，建立与 SQL Azure 的 HTTPS 连接即可实现此目的。

</p>
还有有限容量供应用程序建立一个本地环回连接，并且让应用程序侦听该本地环回套接字。此功能存在主要是实现作为其功能的一部分侦听本地环回套接字的应用程序。请注意，每个客户的应用程序都将看到“私有”环回连接；应用程序“A”无法侦听应用程序“B”建立的本地环回套接字。

还支持命名管道作为共同运行网站的不同进程之间的进程间通信 (IPC) 机制。例如，IIS FastCGI 模块依赖命名管道协调运行 PHP 页的单独进程。

<span id="Code"></span></a>

## 代码执行、处理和内存

如前所述，网站使用随机应用程序池标识运行在低权限辅助进程内运行。应用程序代码有权访问与辅助进程相关联的内存空间，以及可由 CGI 处理器或其他应用程序生成的任何子进程。但是，来自一个网站的应用程序不能访问其他客户网站的内存或数据，即使它们位于同一个虚拟机上。

</p>
应用程序可以运行使用支持的 Web 应用程序开发框架编写的脚本或页面。Azure 网站不将任何 Web 应用程序框架设置配置为更受限制的模式。例如，在 Azure 网站上运行的 ASP.NET 站点以“完全”信任运行，与更受限制的信任模式相反。应用程序框架（包括经典 ASP 和 ASP.NET）可以调用进程中 COM 组件（但不能调用进程外 COM 组件），例如在 Windows 操作系统上默认注册的 ADO（ActiveX 数据对象）。

Web 应用程序可以生成和运行任意代码。允许 Web 应用程序执行诸如生成命令外壳程序或运行 PowerShell 脚本之类的任务。但是，即使可以从 Web 应用程序生成任意代码和进程，可执行程序和脚本仍会被限制为授予父应用程序池的权限。例如，网站可以生成发出出站 HTTP 调用的可执行文件，但同一个可执行文件不能尝试从其 NIC 取消绑定某个虚拟机的 IP 地址。允许向低权限的代码发出出站网络调用，但尝试在虚拟机上重新配置网络设置要求管理权限。

<span id="Diagnostics"></span></a>

## 诊断日志和事件

日志信息是某些 Web 应用程序尝试访问的另外一组数据。可用于在 Azure 网站中运行的代码的日志信息类型包括网站生成的诊断和日志信息，这些信息对于网站而言也是可以轻松进行访问的。

</p>
例如，某一活动网站生成的 W3C HTTP 日志既可以在为该网站创建的网络共享位置中的日志目录上提供，也可以在 Blob 存储中提供（如果客户已经将 W3C 日志设置为记录到存储中）。后者能够收集大量日志，而没有超出与某一网络共享相关联的文件存储限制的风险。

在类似情况下，还可以使用 .NET 跟踪和诊断基础结构将来自 .NET 应用程序的实时诊断信息记入日志，并且可以选择将跟踪信息写入网站的网络共享或写入 Blob 存储位置。

诊断日志记录和跟踪中不可用于 Azure 上的 Web 应用程序的领域是 Windows ETW 事件以及常见的 Windows 事件日志（例如系统、应用程序和安全事件日志）。因为 ETW 跟踪信息可能在计算机范围中是可查看的（具有正确的 ACL），所以，将阻止对 ETW 事件的读写访问。开发人员可能会注意到，对读取和写入 ETW 事件和常见 Windows 事件日志的 API 调用好像在起作用，这是因为 Azure 网站在“伪装”这些调用，让它们看起来很成功。实际上，网站应用程序代码对于此事件数据没有访问权限。

<span id="RegistryAccess"></span></a>

## 注册表访问

应用程序对于它们在其上运行的虚拟机的注册表的大部分内容（尽管不是全部内容）具有只读访问权限。实际上，这意味着 Web 应用程序可以访问允许对本地用户组的只读访问的注册表项。当前不支持读写访问的注册表的一个方面是 HKEY\_CURRENT\_USER Hive。

</p>
对注册表的写访问被阻止，包括对任何按用户注册表项的访问。从应用程序角度来说，对注册表的写访问永远不应依赖于云环境，因为应用程序可以（并且也是这样做的）跨不同虚拟机进行迁移。Web 应用程序可依赖的唯一持久可写入存储是在 Azure 网站 UNC 共享上存储的按网站内容目录结构。

  [网站模式]: #websitemodes
  [开发框架]: #developmentframeworks
  [文件访问]: #FileAccess
  [本地驱动器]: #LocalDrives
  [网络驱动器（aka UNC 共享）]: #NetworkDrives
  [跨多个实例的文件]: #multipleinstances
  [向 Web 应用程序授予的文件访问的类型]: #TypesOfFileAccess
  [网络访问]: #NetworkAccess
  [代码执行、处理和内存]: #Code
  [诊断日志和事件]: #Diagnostics
  [注册表访问]: #RegistryAccess
  [ ]: http://www.iis.net/learn/manage/configuring-security/application-pool-identities
